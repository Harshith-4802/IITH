clc; clear all;close all;
QZ3_Q1_ANS = [[0.-1.02365748j 0.-1.10077953j 0.-1.13771726j];
             [0.-1.10077953j 0.-1.08278969j 0.-1.08843673j];
             [0.-1.13771726j 0.-1.08843673j 0.-1.04824274j]]
% save('QZ3_DS_G1_20.mat', 'QZ3_Q1_ANS')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
U = eye(3);
U2 = eye(2);
a = exp(1j*2*pi/3);
C = [1,1,1;1,a^2,a;1,a,a^2];
   
Y11=0.0000 -27.5400i;
Y21=0.0000 +21.0500i;
Y31=1.5800 + 5.7600i;
Y12=0.0000 +21.0500i;
Y22=0.0000 -60.3200i;
Y32=0.0000 +39.4700i;
Y13=-1.5800 + 5.7600i;
Y23=0.0000 +39.4700i;
Y33=0.0000 -44.2300i;

Ys1s1 = [Y11,Y12;Y21,Y22];
Ys1s2 = [Y13;Y23];
Ys2s1 = [Y31,Y32];
Ys2s2 = Y33;

QZ3_Q2_ANS = (U2-(Ys1s2*[1,0]/Ys2s2))\(Ys1s1-(Ys1s2*Ys2s1/Ys2s2))
% save('QZ3_DS_G1_20.mat','QZ3_Q2_ANS','-append')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
y2(1,1)	=-27.54j;
y2(2,1)	=21.05j;
y2(3,1)	=-1.58+5.76j;
y2(1,2)	=21.05j;
y2(2,2)	=-60.32j;
y2(3,2)	=39.47j;
y2(1,3)	=1.58+5.76j;
y2(2,3)	=39.47j;
y2(3,3)	=-44.23j;

z1 = 0.23j;
z2 = 0.27j;
z3 = 0.15j;


ynewele = [z1, z3;z3, z2]^(-1);

yn1 = ynewele(1, 1);
yn2 = ynewele(2, 2);
yn3 = ynewele(1, 2);

y2(1,1) = y2(1,1)+yn1;
y2(1,2) = y2(1,2)-yn1;
y2(2,2) = y2(2,2)+yn1;
y2(2,1) = y2(2,1)-yn1;

y2(2,2) = y2(2,2)+yn2;
y2(2,3) = y2(2,3)-yn2;
y2(3,3) = y2(3,3)+yn2;
y2(3,2) = y2(3,2)-yn2;

y2(1,2) = y2(1,2)+yn3;
y2(1,3) = y2(1,3)-yn3;
y2(2,3) = y2(2,3)+yn3;
y2(2,2) = y2(2,2)-yn3;

y2(2,1) = y2(2,1)+yn3;
y2(3,1) = y2(3,1)-yn3;
y2(3,2) = y2(3,2)+yn3;
y2(2,2) = y2(2,2)-yn3;

QZ3_Q3_ANS = y2
% save('QZ3_DS_G1_20.mat','QZ3_Q3_ANS','-append')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Z_bus(1,1)=	0	-0.99j;
Z_bus(2,1)=	0.04	-1.08j;
Z_bus(3,1)=	0.08	-1.08j;
Z_bus(4,1)	=0	-0.99j;
Z_bus(1,2)	=-0.04	-1.08j;
Z_bus(2,2)	=0	-0.99j;
Z_bus(3,2)	=0.04	-1.1j;
Z_bus(4,2)	=-0.04	-1.08j;
Z_bus(1,3)	=-0.08	-1.08j;
Z_bus(2,3)	=-0.04	-1.1j;
Z_bus(3,3)	=0	-1.04j;
Z_bus(4,3)	=-0.08	-1.08j;
Z_bus(1,4)	=0	-0.99j;
Z_bus(2,4)	=0.04	-1.08j;
Z_bus(3,4)	=0.08	-1.08j;
Z_bus(4,4)	=0	-0.99j;

z12 = 0.23j;
z23 = 0.27j;
m = 0.15j;


Z_new = alter(1, 2, 1, 2, z12, Z_bus);
Z_new = alter(1, 2, 2, 3, m, Z_new);
Z_new = alter(2, 3, 1, 2, m, Z_new);
QZ3_Q4_ANS = Z_new
% save('QZ3_DS_G1_20.mat','QZ3_Q4_ANS','-append')
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Z0(1,1)=	0	-0.9j;
Z0(2,1)=    0.07	-1.09j;
Z0(3,1)=	0.12	-1.04j;
Z0(4,1)=	0	-0.9j;
Z0(1,2)=	-0.07	-1.09j;
Z0(2,2)=	0	-0.8j;
Z0(3,2)=	0.07	-1.14j;
Z0(4,2)=	-0.07	-1.09j;
Z0(1,3)=	-0.12	-1.04j;
Z0(2,3)=	-0.07	-1.14j;
Z0(3,3)=	0	-0.98j;
Z0(4,3)=	-0.12	-1.04j;
Z0(1,4)=	0	-0.9j;
Z0(2,4)=	0.07	-1.09j;
Z0(3,4)=	0.12	-1.04j;
Z0(4,4)=	0	-0.9j;
Z1 = Z_bus;
Z2 = Z1;
QZ3_Q5_ANS = zeros(12,12);
for i=1:4
  for k=1:4
    QZ3_Q5_ANS(3*(i-1)+1:3*i,3*(k-1)+1:3*k) = C*diag([Z0(i,k),Z1(i,k),Z2(i,k)])/C;
  end
end
QZ3_Q5_ANS
% save('QZ3_DS_G1_20.mat','QZ3_Q5_ANS','-append')
save('QZ3_ANS_G1_20.mat','QZ3_Q1_ANS','QZ3_Q2_ANS','QZ3_Q3_ANS','QZ3_Q4_ANS','QZ3_Q5_ANS')

function Zn = alter(m, n, p, q, zm, Z)
    Zpm = Z(p, m);
    Zqn = Z(q, n);
    Zpn = Z(p, n);
    Zqm = Z(q, m);
    dZCmn = Z(:, m) - Z(:, n);
    dZRpq = Z(p, :) - Z(q, :);
    Zn = Z - ((Zpm+Zqn-Zpn-Zqm+zm)^(-1))*(dZCmn*dZRpq);
end
